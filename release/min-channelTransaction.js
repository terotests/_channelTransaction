(function(){var n={},t=function(){var t=function(){!function(n){n.guid=function(){return Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15)},n.isArray=function(n){return n instanceof Array},n.isFunction=function(n){return"[object Function]"==Object.prototype.toString.call(n)},n.isObject=function(n){return n===Object(n)}}(this),function(n){var t;n.hasOwnProperty("__factoryClass")||(n.__factoryClass=[]),n.__factoryClass.push(function(n){return t||(t={}),t[n]?t[n]:void(t[n]=this)}),n.execute=function(n){var t={id:n.id,from:n.from,result:!1,rollBack:!1,failed:[]};if(!n.id)return t;if(this._done[n.id])return t;this._done[n.id]=!0;try{var r=this._channel.getJournalLine();if(n.from!=r){t.invalidStart=!0,t.result=!1,t.correctStart=n.from,t.correctLines=[];for(var i=n.from;r>i;i++)t.correctLines.push(this._channel._journal[i]);return t}for(var e=0,i=0;i<n.commands.length;i++){var a=n.commands[i];if(!this._channel.execCmd(a)){if(n.fail_tolastok){t.validCnt=e;var r=this._channel.getJournalLine();t.correctStart=n.from,t.correctLines=[];for(var i=n.from;r>i;i++)t.correctLines.push(this._channel._journal[i])}else{t.validCnt=0,this._channel.undo(e);var r=this._channel.getJournalLine();t.correctStart=n.from,t.correctLines=[];for(var i=n.from;r>i;i++)t.correctLines.push(this._channel._journal[i])}return t}e++}0==t.failed.length&&(t.result=!0);var r=this._channel.getJournalLine();t.correctStart=n.from,t.correctLines=[];for(var i=n.from;r>i;i++)t.correctLines.push(this._channel._journal[i]);return t.validCnt=e,t}catch(o){return t.result=!1,t}},n.__traitInit&&!n.hasOwnProperty("__traitInit")&&(n.__traitInit=n.__traitInit.slice()),n.__traitInit||(n.__traitInit=[]),n.__traitInit.push(function(n,t){this._channelId=n,this._channel=t,this._done={}}),n.rollBack=function(n,t){n&&t&&t.rollBack&&n.reverseToLine(t.rollBackTo)}}(this)},r=function(n,t,i,e,a,o,c,s){var f,l=this;if(!(l instanceof r))return new r(n,t,i,e,a,o,c,s);var u=[n,t,i,e,a,o,c,s];if(l.__factoryClass)if(l.__factoryClass.forEach(function(n){f=n.apply(l,u)}),"function"==typeof f){if(f._classInfo.name!=r._classInfo.name)return new f(n,t,i,e,a,o,c,s)}else if(f)return f;l.__traitInit?l.__traitInit.forEach(function(n){n.apply(l,u)}):"function"==typeof l.init&&l.init.apply(l,u)};r._classInfo={name:"_channelTransaction"},r.prototype=new t,function(){"undefined"!=typeof define&&null!==define&&null!=define.amd?(n._channelTransaction=r,this._channelTransaction=r):"undefined"!=typeof module&&null!==module&&null!=module.exports?module.exports._channelTransaction=r:this._channelTransaction=r}.call(new Function("return this")()),function(n){n.__traitInit&&!n.hasOwnProperty("__traitInit")&&(n.__traitInit=n.__traitInit.slice()),n.__traitInit||(n.__traitInit=[]),n.__traitInit.push(function(){})}(this)},r=function(n,t,i,e,a,o,c,s){var f,l=this;if(!(l instanceof r))return new r(n,t,i,e,a,o,c,s);var u=[n,t,i,e,a,o,c,s];if(l.__factoryClass)if(l.__factoryClass.forEach(function(n){f=n.apply(l,u)}),"function"==typeof f){if(f._classInfo.name!=r._classInfo.name)return new f(n,t,i,e,a,o,c,s)}else if(f)return f;l.__traitInit?l.__traitInit.forEach(function(n){n.apply(l,u)}):"function"==typeof l.init&&l.init.apply(l,u)};r._classInfo={name:"channelTransactionModule"},r.prototype=new t,"undefined"!=typeof define&&null!==define&&null!=define.amd&&define(n)}).call(new Function("return this")());